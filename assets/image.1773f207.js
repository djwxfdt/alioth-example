import{r as m,u as b,a as U,b as K,c as R,d as g,R as s,C as c,L as W}from"./index.b19a1df5.js";import{R as x}from"./resize-image.ae8411c3.js";var H=function(o){m.exports.useEffect(function(){o()},[])},N=H;const M=e=>{const o=b(),l=U(),P=K(),[a,h]=R(e.attributes.id,{status:e.passProps.fileUrl||e.passProps.fileKey?"done":"pending",process:e.passProps.fileUrl||e.passProps.fileKey?100:0}),[u,d]=m.exports.useState();m.exports.useEffect(()=>{a.publicUrl&&d(a.publicUrl)},[a.publicUrl]);const[t,f]=m.exports.useState(),p=a.status==="pending",w=g(n=>{o.setNode(e.fiber,{props:{width:n}}),o.flush()}),E=g(n=>{var r;(r=l.onTransformFileKey)==null||r.call(l,n).then(i=>{d(i)})}),y=g(n=>{var r;(r=l.onTransformUrl)==null||r.call(l,n,{onProcess:i=>{h({status:"pending",process:i})}}).then(i=>{h({status:"done",process:100}),d(i.fileUrl),o.setNode(e.fiber,{props:{fileKey:i.fileKey,originalWidth:i.originalWidth,originalHeight:i.originalHeight,width:e.passProps.width||(i==null?void 0:i.width)}}),o.flush()}).catch(()=>{h({status:"done",process:100})})});return N(()=>{if(e.passProps.fileKey){E(e.passProps.fileKey);return}if(e.passProps.fileUrl)return d(e.passProps.fileUrl);if(!!e.passProps.url){if(y(e.passProps.url),h({status:"pending",process:0}),e.passProps.originalWidth){const n=Math.round(e.passProps.width/(e.passProps.originalWidth/e.passProps.originalHeight));f({width:e.passProps.width,height:n});return}if(e.passProps.width){f({width:e.passProps.width,height:e.passProps.width*.5});return}f({width:200,height:100})}}),s.createElement(s.Fragment,null,s.createElement(c,{isShow:!p&&!!u},s.createElement(x,{readOnly:P,fileUrl:a.thumbnail||u,width:e.passProps.width,originalHeight:e.passProps.originalHeight,originalWidth:e.passProps.originalWidth,onResizeEnd:w})),s.createElement(c,{isShow:p},s.createElement("span",{className:"alioth-image-pending",style:{maxWidth:"100%",width:t==null?void 0:t.width}},s.createElement("span",{className:"alioth-image-pending-mask"},s.createElement(W,null),s.createElement("span",{className:"alioth-image-process"},a.process,"%")),s.createElement(c,{isShow:!!a.thumbnail},s.createElement("img",{style:{maxWidth:"100%"},width:t==null?void 0:t.width,src:a.thumbnail})),s.createElement(c,{isShow:!a.thumbnail},s.createElement("div",{style:{paddingBottom:`${100*(t==null?void 0:t.height)/(t==null?void 0:t.width)}%`}})))))};export{M as default};
